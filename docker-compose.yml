version: '2'

services:
  crdb:
    image: cockroachdb/cockroach:v20.1.8
    command: start --insecure
    ports:
      - '8083:8080'
      - '26257:26257'
    volumes:
      - './data/cockroach:/cockroach/cockroach-data'

  api:
    build:
      context: .
    ports:
      - '3000:3000'
    volumes:
      - './app:/home/api/app'
      - './config:/home/api/config'
      - './lib:/home/api/lib'
      - './Gemfile:/home/api/Gemfile'
      - './db:/home/api/db'
      - './doc:/home/api/doc'
      - './spec:/home/api/spec'
      - './entrypoint.sh:/home/api/entrypoint.sh'
      - './storage:/home/api/storage'
    depends_on:
     - crdb